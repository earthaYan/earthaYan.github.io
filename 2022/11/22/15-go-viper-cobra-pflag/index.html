<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="15-go-viper-cobra-pflag" />
    <meta name="hexo-theme-A4" content="v1.7.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Diary | just try it</title>

    
        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
    
    
<link rel="stylesheet" href="/css/ui.css">
 
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>
    
    <body>
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Diary</a> 
            <span class="description">é»˜å¥¥æ²™</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            15-go-viper-cobra-pflag
        </div>
      
    

    <div class="post-md">
        
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6"><span class="post-toc-text">å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90-pflag-%E5%8C%85"><span class="post-toc-text">å‘½ä»¤è¡Œå‚æ•°è§£æ pflag åŒ…</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#flag-%E5%AE%9A%E4%B9%89"><span class="post-toc-text">flag å®šä¹‰</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#FlagSet-%E5%AE%9A%E4%B9%89"><span class="post-toc-text">FlagSet å®šä¹‰</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="post-toc-text">å¸¸ç”¨æ–¹æ³•</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90-viper"><span class="post-toc-text">é…ç½®æ–‡ä»¶è§£æ viper</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E6%8E%92%E5%BA%8F"><span class="post-toc-text">ä¼˜å…ˆçº§æ’åº</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%AF%BB%E5%85%A5%E9%85%8D%E7%BD%AE%EF%BC%9A%E5%B0%86%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%85%A5%E5%88%B0-Viper-%E4%B8%AD"><span class="post-toc-text">è¯»å…¥é…ç½®ï¼šå°†é…ç½®è¯»å…¥åˆ° Viper ä¸­</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE"><span class="post-toc-text">è¯»å–é…ç½®</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%BA%94%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A1%86%E6%9E%B6-Cobra"><span class="post-toc-text">åº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶ Cobra</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BA%94%E7%94%A8%E7%9A%84%E4%B8%89%E5%A4%A7%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="post-toc-text">åº”ç”¨çš„ä¸‰å¤§åŸºæœ¬åŠŸèƒ½</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E4%B8%80%E8%87%B4"><span class="post-toc-text">å¯åŠ¨æµç¨‹ä¸€è‡´</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#iam-apiServer"><span class="post-toc-text">iam-apiServer</span></a></li></ol>
        
        <h2 id="å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶"><a href="#å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶" class="headerlink" title="å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶"></a>å¦‚ä½•æ„å»ºåº”ç”¨æ¡†æ¶</h2><h3 id="å‘½ä»¤è¡Œå‚æ•°è§£æ-pflag-åŒ…"><a href="#å‘½ä»¤è¡Œå‚æ•°è§£æ-pflag-åŒ…" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°è§£æ pflag åŒ…"></a>å‘½ä»¤è¡Œå‚æ•°è§£æ pflag åŒ…</h3><p>ç”¨æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ã€å¯åŠ¨å‚æ•°ã€‘ï¼Œè¿™äº›å‘½ä»¤è¡Œå‚æ•°å¯ä»¥å½±å“å‘½ä»¤çš„è¿è¡Œæ•ˆæœã€‚</p>
<h4 id="flag-å®šä¹‰"><a href="#flag-å®šä¹‰" class="headerlink" title="flag å®šä¹‰"></a>flag å®šä¹‰</h4><p>ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°åœ¨ Pflag åŒ…ä¸­ä¼šè§£æä¸ºä¸€ä¸ª Flag ç±»å‹çš„å˜é‡ï¼Œå³:</p>
<pre><code class="go">
type Flag struct &#123;
    Name                string // flagé•¿é€‰é¡¹çš„åç§°
    Shorthand           string // flagçŸ­é€‰é¡¹çš„åç§°ï¼Œä¸€ä¸ªç¼©å†™çš„å­—ç¬¦
    Usage               string // flagçš„ä½¿ç”¨æ–‡æœ¬
    Value               Value  // flagçš„å€¼
    DefValue            string // flagçš„é»˜è®¤å€¼
    Changed             bool // è®°å½•flagçš„å€¼æ˜¯å¦æœ‰è¢«è®¾ç½®è¿‡
    NoOptDefVal         string // å½“flagå‡ºç°åœ¨å‘½ä»¤è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®šé€‰é¡¹å€¼æ—¶çš„é»˜è®¤å€¼
    Deprecated          string // è®°å½•è¯¥flagæ˜¯å¦è¢«æ”¾å¼ƒ
    Hidden              bool // å¦‚æœå€¼ä¸ºtrueï¼Œåˆ™ä»help/usageè¾“å‡ºä¿¡æ¯ä¸­éšè—è¯¥flag
    ShorthandDeprecated string // å¦‚æœflagçš„çŸ­é€‰é¡¹è¢«åºŸå¼ƒï¼Œå½“ä½¿ç”¨flagçš„çŸ­é€‰é¡¹æ—¶æ‰“å°è¯¥ä¿¡æ¯
    Annotations         map[string][]string // ç»™flagè®¾ç½®æ³¨è§£
&#125;
</code></pre>
<p>Flag çš„å€¼æ˜¯ä¸€ä¸ª Value ç±»å‹çš„æ¥å£ï¼Œé€šè¿‡å°† Flag çš„å€¼æŠ½è±¡æˆä¸€ä¸ª interface æ¥å£ï¼Œå¯ä»¥è‡ªå®šä¹‰ Flag çš„ç±»å‹äº†,åªè¦å®ç°äº† Value æ¥å£çš„ç»“æ„ä½“ï¼Œå°±æ˜¯ä¸€ä¸ªæ–°ç±»å‹</p>
<pre><code class="go">
type Value interface &#123;
    String() string // å°†flagç±»å‹çš„å€¼è½¬æ¢ä¸ºstringç±»å‹çš„å€¼ï¼Œå¹¶è¿”å›stringçš„å†…å®¹
    Set(string) error // å°†stringç±»å‹çš„å€¼è½¬æ¢ä¸ºflagç±»å‹çš„å€¼ï¼Œè½¬æ¢å¤±è´¥æŠ¥é”™
    Type() string // è¿”å›flagçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šstringã€intã€ipç­‰
&#125;
</code></pre>
<p>å®é™…ä½¿ç”¨ï¼š</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
)

type Value interface &#123;
    String() string // å°†flagç±»å‹çš„å€¼è½¬æ¢ä¸ºstringç±»å‹çš„å€¼ï¼Œå¹¶è¿”å›stringçš„å†…å®¹
    Set(string) error // å°†stringç±»å‹çš„å€¼è½¬æ¢ä¸ºflagç±»å‹çš„å€¼ï¼Œè½¬æ¢å¤±è´¥æŠ¥é”™
    Type() string // è¿”å›flagçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šstringã€intã€ipç­‰
&#125;

type Flag struct &#123;
    Name                string // flagé•¿é€‰é¡¹çš„åç§°
    Shorthand           string // flagçŸ­é€‰é¡¹çš„åç§°ï¼Œä¸€ä¸ªç¼©å†™çš„å­—ç¬¦
    Usage               string // flagçš„ä½¿ç”¨æ–‡æœ¬
    Value               Value  // flagçš„å€¼
    DefValue            string // flagçš„é»˜è®¤å€¼
    Changed             bool // è®°å½•flagçš„å€¼æ˜¯å¦æœ‰è¢«è®¾ç½®è¿‡
    NoOptDefVal         string // å½“flagå‡ºç°åœ¨å‘½ä»¤è¡Œï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®šé€‰é¡¹å€¼æ—¶çš„é»˜è®¤å€¼
    Deprecated          string // è®°å½•è¯¥flagæ˜¯å¦è¢«æ”¾å¼ƒ
    Hidden              bool // å¦‚æœå€¼ä¸ºtrueï¼Œåˆ™ä»help/usageè¾“å‡ºä¿¡æ¯ä¸­éšè—è¯¥flag
    ShorthandDeprecated string // å¦‚æœflagçš„çŸ­é€‰é¡¹è¢«åºŸå¼ƒï¼Œå½“ä½¿ç”¨flagçš„çŸ­é€‰é¡¹æ—¶æ‰“å°è¯¥ä¿¡æ¯
    Annotations         map[string][]string // ç»™flagè®¾ç½®æ³¨è§£
&#125;

func (flag1 Flag) String() &#123;
    fmt.Println(&quot;å°†flagç±»å‹çš„å€¼è½¬æ¢ä¸ºstringç±»å‹çš„å€¼ï¼Œå¹¶è¿”å›stringçš„å†…å®¹&quot;)
&#125;

type Flag2 struct &#123;
  Value               Value  // flagçš„å€¼
&#125;

func (flag2 Flag2) String() &#123;
    fmt.Println(&quot;è‡ªå®šä¹‰flagç±»å‹&quot;)
&#125;

func main() &#123;
    var val Value
    flag1 = new(Flag)
    flag1.String()
    flag2 = new(Flag2)
    flag2.String()
&#125;
</code></pre>
<h4 id="FlagSet-å®šä¹‰"><a href="#FlagSet-å®šä¹‰" class="headerlink" title="FlagSet å®šä¹‰"></a>FlagSet å®šä¹‰</h4><p>é¢„å…ˆå®šä¹‰å¥½çš„ Flag çš„é›†åˆ<br>è·å–å¹¶ä½¿ç”¨ Flag çš„æ–¹æ³•ï¼š</p>
<ol>
<li>è°ƒç”¨ NewFlagSet åˆ›å»ºä¸€ä¸ª FlagSet,é€šè¿‡å®šä¹‰ä¸€ä¸ªæ–°çš„ FlagSet æ¥å®šä¹‰å‘½ä»¤åŠå…¶å­å‘½ä»¤çš„ Flagã€‚</li>
</ol>
<pre><code class="go">var version bool
flagSet:=pflag.NewFlagSet(&quot;test&quot;,pflag.ContinueOnError)
flagSet.BoolVar(&amp;version,&quot;version&quot;,true,&quot;Print version information and quit.&quot;)
</code></pre>
<ol start="2">
<li>ä½¿ç”¨ Pflag åŒ…å®šä¹‰çš„å…¨å±€ FlagSetï¼šCommandLineã€‚å®é™…ä¸Š CommandLine ä¹Ÿæ˜¯ç”± NewFlagSet å‡½æ•°åˆ›å»ºçš„<br>åœ¨ä¸€äº›ä¸éœ€è¦å®šä¹‰å­å‘½ä»¤çš„å‘½ä»¤è¡Œå·¥å…·ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å…¨å±€çš„ FlagSet</li>
</ol>
<pre><code class="go">
import (
    &quot;github.com/spf13/pflag&quot;
)

pflag.BoolVarP(&amp;version, &quot;version&quot;, &quot;v&quot;, true, &quot;Print version information and quit.&quot;)
func BoolVarP(p *bool, name, shorthand string, value bool, usage string) &#123;
  flag := CommandLine.VarPF(newBoolValue(value, p), name, shorthand, usage)
  flag.NoOptDefVal = &quot;true&quot;
&#125;
</code></pre>
<h4 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h4><hr>
<ol>
<li>æ”¯æŒå¤šç§å‘½ä»¤è¡Œå‚æ•°å®šä¹‰æ–¹å¼</li>
</ol>
<ul>
<li>æ”¯æŒé•¿é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­</li>
</ul>
<pre><code class="go">var name=pflag.String(&quot;name&quot;,&quot;colin&quot;,&quot;Input ur name&quot;)
</code></pre>
<ul>
<li>æ”¯æŒé•¿é€‰é¡¹ã€çŸ­é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­</li>
</ul>
<pre><code class="go">var name=pflag.StringP(&quot;name&quot;,&quot;n&quot;,&quot;colin&quot;,&quot;input ur name&quot;)
</code></pre>
<ul>
<li>æ”¯æŒé•¿é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡</li>
</ul>
<pre><code class="go">var name string
pflag.StringVar(&amp;name,&quot;name&quot;,&quot;colin&quot;,&quot;Input ur name&quot;)
</code></pre>
<ul>
<li>æ”¯æŒé•¿é€‰é¡¹ã€çŸ­é€‰é¡¹ã€é»˜è®¤å€¼å’Œä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶å°†æ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡</li>
</ul>
<pre><code class="go">var name string
pflag.StringVarP(&amp;name, &quot;name&quot;, &quot;n&quot;,&quot;colin&quot;, &quot;Input Your Name&quot;)
</code></pre>
<blockquote>
<ol>
<li>å‡½æ•°åå¸¦æœ‰ Var è¯´æ˜æ˜¯å°†æ ‡å¿—çš„å€¼ç»‘å®šåˆ°å˜é‡ï¼Œå¦åˆ™å°±æ˜¯å°†æ ‡å¿—çš„å€¼å­˜å‚¨åœ¨æŒ‡é’ˆä¸­</li>
<li>å‡½æ•°åå¸¦ P è¯´æ˜æ”¯æŒçŸ­é€‰é¡¹ï¼Œå¦åˆ™ä¸æ”¯æŒçŸ­é€‰é¡¹ã€‚</li>
</ol>
</blockquote>
<hr>
<ol start="2">
<li>ä½¿ç”¨ Get<Type> è·å–å‚æ•°çš„å€¼</li>
</ol>
<pre><code class="go">
i, err := flagset.GetInt(&quot;flagname&quot;)
</code></pre>
<hr>
<ol start="3">
<li>è·å–éé€‰é¡¹å‚æ•°</li>
</ol>
<pre><code class="go">
package main

import (
    &quot;fmt&quot;
    &quot;github.com/spf13/pflag&quot;
)
// å®šä¹‰æ ‡å¿—
var  flagvar = pflag.Int(&quot;flagname&quot;, 1234, &quot;help message for flagname&quot;)

func main() &#123;
    // è§£æå®šä¹‰çš„æ ‡å¿—
    pflag.Parse()
    // è¿”å›æ— é€‰é¡¹å‚æ•°
    fmt.Printf(&quot;argument number is: %v\n&quot;, pflag.NArg())
    // è¿”å›æ‰€æœ‰çš„éé€‰é¡¹å‚æ•°
    fmt.Printf(&quot;argument list is: %v\n&quot;, pflag.Args())
    //pflag.Arg(i) è¿”å›ç¬¬ i ä¸ªéé€‰é¡¹å‚æ•°
    fmt.Printf(&quot;the first argument is: %v\n&quot;, pflag.Arg(0))
&#125;
// go run example1.go arg1 arg2
// argument number is: 2
// argument list is: [arg1 arg2]
// the first argument is: arg1
</code></pre>
<hr>
<ol start="4">
<li>æŒ‡å®šäº†é€‰é¡¹ä½†æ˜¯æ²¡æœ‰æŒ‡å®šé€‰é¡¹å€¼æ—¶çš„é»˜è®¤å€¼</li>
</ol>
<pre><code class="go">// å®šä¹‰æ ‡å¿—
var ip = pflag.IntP(&quot;flagname&quot;, &quot;f&quot;, 1234, &quot;help message&quot;)
// ä¸ºipè¿™ä¸ªflagè®¾ç½®NoOptDefVal,
pflag.Lookup(&quot;flagname&quot;).NoOptDefVal = &quot;4321&quot;
</code></pre>
<table>
<thead>
<tr>
<th>å‘½ä»¤è¡Œå‚æ•°</th>
<th>è§£æç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>â€“flagname&#x3D;1357</td>
<td>ip&#x3D;1357</td>
</tr>
<tr>
<td>â€“flagname</td>
<td>ip&#x3D;4321</td>
</tr>
<tr>
<td></td>
<td>ip&#x3D;1234</td>
</tr>
</tbody></table>
<hr>
<ol start="5">
<li>å¼ƒç”¨æ ‡å¿—æˆ–è€…å¼ƒç”¨æ ‡å¿—çš„ç®€å†™</li>
</ol>
<p>åœ¨å¸®åŠ©æ–‡æœ¬ä¸­ä¼šè¢«éšè—ï¼Œå¹¶åœ¨ä½¿ç”¨ä¸æ¨èçš„æ ‡å¿—æˆ–ç®€å†™æ—¶æ‰“å°æ­£ç¡®çš„ç”¨æ³•æç¤º</p>
<pre><code class="go">pflag.CommandLine.MarkDeprecated(&quot;logmode&quot;,&quot;please use --log-mode instead&quot;)
//éšè—å¸®åŠ©æ–‡æœ¬ä¸­çš„logmode.å½“ä½¿ç”¨logmodeçš„æ—¶å€™ï¼Œæ‰“å°å‡º Flag --logmode has been deprecated, please use --log-mode insteadã€‚
</code></pre>
<hr>
<ol start="6">
<li>åªå¼ƒç”¨ç®€å†™å½¢å¼</li>
</ol>
<pre><code class="go">pflag.IntVarP(&amp;port,&quot;port&quot;,&quot;p&quot;,3306,&quot;MySQL service host port.&quot;)
// å¼ƒç”¨ç®€å†™å½¢å¼
pflag.CommandLine.MarkShorthandDeprecated(&quot;port&quot;, &quot;please use --port only&quot;)

// è¿™æ ·éšè—äº†å¸®åŠ©æ–‡æœ¬ä¸­çš„ç®€å†™ Pï¼Œå¹¶ä¸”å½“ä½¿ç”¨ç®€å†™ P æ—¶ï¼Œæ‰“å°äº†Flag shorthand -P has been deprecated, please use --port onlyã€‚usage message åœ¨æ­¤å¤„å¿…ä¸å¯å°‘ï¼Œå¹¶ä¸”ä¸åº”ä¸ºç©ºã€‚
</code></pre>
<hr>
<ol start="7">
<li>éšè—æ ‡å¿—</li>
</ol>
<p>å°† Flag æ ‡è®°ä¸ºéšè—ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†ä¸ä¼šæ˜¾ç¤ºåœ¨ usage&#x2F;help ä¸­,åªåœ¨å†…éƒ¨ä½¿ç”¨</p>
<pre><code class="go">// hide a flag by specifying its name
pflag.CommandLine.MarkHidden(&quot;secretFlag&quot;)
</code></pre>
<hr>
<h3 id="é…ç½®æ–‡ä»¶è§£æ-viper"><a href="#é…ç½®æ–‡ä»¶è§£æ-viper" class="headerlink" title="é…ç½®æ–‡ä»¶è§£æ viper"></a>é…ç½®æ–‡ä»¶è§£æ viper</h3><p>å°å‹åº”ç”¨ï¼šé…ç½®é¡¹è¾ƒå°‘,å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥ä¼ é€’é…ç½®<br>å¤§å‹åº”ç”¨ï¼šé…ç½®é¡¹è¾ƒå¤š,é€šå¸¸å…·æœ‰å¾ˆå¤šå‚æ•°ï¼Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ä¸å¥½ç»´æŠ¤ã€‚<br>è§£å†³æ–¹æ³•ï¼šå°†è¿™äº›é…ç½®ä¿¡æ¯ä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œç”±ç¨‹åºå¯åŠ¨æ—¶åŠ è½½å’Œè§£æ<br>Viper ç‰¹ç‚¹ï¼š<br>é«˜ä¼˜å…ˆçº§é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§ç›¸åŒé…ç½®</p>
<h4 id="ä¼˜å…ˆçº§æ’åº"><a href="#ä¼˜å…ˆçº§æ’åº" class="headerlink" title="ä¼˜å…ˆçº§æ’åº"></a>ä¼˜å…ˆçº§æ’åº</h4><ol>
<li>é€šè¿‡ viper.Set å‡½æ•°æ˜¾ç¤ºè®¾ç½®çš„é…ç½®</li>
<li>å‘½ä»¤è¡Œå‚æ•°</li>
<li>ç¯å¢ƒå˜é‡</li>
<li>é…ç½®æ–‡ä»¶</li>
<li>Key&#x2F;Value å­˜å‚¨</li>
<li>é»˜è®¤å€¼</li>
</ol>
<h4 id="è¯»å…¥é…ç½®ï¼šå°†é…ç½®è¯»å…¥åˆ°-Viper-ä¸­"><a href="#è¯»å…¥é…ç½®ï¼šå°†é…ç½®è¯»å…¥åˆ°-Viper-ä¸­" class="headerlink" title="è¯»å…¥é…ç½®ï¼šå°†é…ç½®è¯»å…¥åˆ° Viper ä¸­"></a>è¯»å…¥é…ç½®ï¼šå°†é…ç½®è¯»å…¥åˆ° Viper ä¸­</h4><ol>
<li>è®¾ç½®é»˜è®¤çš„é…ç½®æ–‡ä»¶å</li>
</ol>
<pre><code class="go">
viper.SetDefault(&quot;ContentDir&quot;, &quot;content&quot;)
viper.SetDefault(&quot;LayoutDir&quot;, &quot;layouts&quot;)
viper.SetDefault(&quot;Taxonomies&quot;, map[string]string&#123;&quot;tag&quot;: &quot;tags&quot;, &quot;category&quot;: &quot;categories&quot;&#125;)
</code></pre>
<hr>
<ol start="2">
<li>è¯»å–é…ç½®æ–‡ä»¶</li>
</ol>
<p>æ”¯æŒ JSONã€TOMLã€YAMLã€YMLã€Propertiesã€Propsã€Propã€HCLã€Dotenvã€Env æ ¼å¼çš„é…ç½®æ–‡ä»¶</p>
<pre><code class="go">
package main

import (
  &quot;fmt&quot;
  &quot;github.com/spf13/pflag&quot;
  &quot;github.com/spf13/viper&quot;
)

var (
  cfg  = pflag.StringP(&quot;config&quot;, &quot;c&quot;, &quot;&quot;, &quot;Configuration file.&quot;)
  help = pflag.BoolP(&quot;help&quot;, &quot;h&quot;, false, &quot;Show this help message.&quot;)
)

func main() &#123;
  pflag.Parse()
  if *help &#123;
    pflag.Usage()
    return
  &#125;
  // ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®
  if *cfg != &quot;&quot; &#123;
    viper.SetConfigFile(*cfg)   // æŒ‡å®šé…ç½®æ–‡ä»¶å
    // å¦‚æœé…ç½®æ–‡ä»¶åä¸­æ²¡æœ‰æ–‡ä»¶æ‰©å±•åï¼Œåˆ™éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ ¼å¼ï¼Œå‘Šè¯‰viperä»¥ä½•ç§æ ¼å¼è§£ææ–‡ä»¶
    viper.SetConfigType(&quot;yaml&quot;)
  &#125; else &#123;
    // ä¼šæ ¹æ®æ·»åŠ çš„è·¯å¾„é¡ºåºæœç´¢é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°åˆ™åœæ­¢æœç´¢
    viper.AddConfigPath(&quot;.&quot;)          // æŠŠå½“å‰ç›®å½•åŠ å…¥åˆ°é…ç½®æ–‡ä»¶çš„æœç´¢è·¯å¾„ä¸­
    viper.AddConfigPath(&quot;$HOME/.iam&quot;) // é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªé…ç½®æ–‡ä»¶æœç´¢è·¯å¾„
    viper.SetConfigName(&quot;config&quot;)     // é…ç½®æ–‡ä»¶åç§°ï¼ˆæ²¡æœ‰æ–‡ä»¶æ‰©å±•åï¼‰
  &#125;

  if err := viper.ReadInConfig(); err != nil &#123;
    // è¯»å–é…ç½®æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šäº†é…ç½®æ–‡ä»¶åï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™åœ¨æ³¨å†Œçš„æœç´¢è·¯å¾„ä¸­æœç´¢
    panic(fmt.Errorf(&quot;Fatal error config file: %s \n&quot;, err))
  &#125;
  fmt.Printf(&quot;Used configuration file is: %s\n&quot;, viper.ConfigFileUsed())
&#125;
</code></pre>
<hr>
<ol start="3">
<li>ç›‘å¬å’Œé‡æ–°è¯»å–é…ç½®æ–‡ä»¶ã€ä¸æ¨èã€‘</li>
</ol>
<p>åœ¨è¿è¡Œçš„æ—¶å€™åº”ç”¨ç¨‹åºå®æ—¶è¯»å–é…ç½®æ–‡ä»¶[çƒ­åŠ è½½é…ç½®]ã€‚é€šè¿‡<code>WatchConfig</code>å‡½æ•°è¿›è¡Œæ“ä½œã€‚<br>åœ¨æ“ä½œä¹‹å‰éœ€è¦ç¡®ä¿å·²ç»æ·»åŠ äº†é…ç½®æ–‡ä»¶çš„æœç´¢è·¯å¾„<br>å¯ä»¥ä¸º Viper æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡å‘ç”Ÿæ›´æ”¹æ—¶è¿è¡Œ<br>ä¸æ¨èä½¿ç”¨åŸå› ï¼šå› ä¸ºå³ä½¿é…ç½®çƒ­åŠ è½½äº†ï¼Œç¨‹åºä¸­çš„ä»£ç ä¹Ÿä¸ä¸€å®šä¼šçƒ­åŠ è½½ã€‚ä¾‹å¦‚ï¼šä¿®æ”¹äº†æœåŠ¡ç›‘å¬ç«¯å£ï¼Œä½†æ˜¯æœåŠ¡æ²¡æœ‰é‡å¯ï¼Œè¿™æ—¶å€™æœåŠ¡è¿˜æ˜¯ç›‘å¬åœ¨è€çš„ç«¯å£ä¸Šï¼Œä¼šé€ æˆä¸ä¸€è‡´ã€‚</p>
<pre><code class="go">viper.WatchConfig()
viper.OnConfigChange(func(e fsnotify.Event) &#123;
   // é…ç½®æ–‡ä»¶å‘ç”Ÿå˜æ›´ä¹‹åä¼šè°ƒç”¨çš„å›è°ƒå‡½æ•°
  fmt.Println(&quot;Config file changed:&quot;, e.Name)
&#125;)
</code></pre>
<hr>
<ol start="4">
<li>ä» io.Reader è¯»å–é…ç½®</li>
</ol>
<hr>
<ol start="5">
<li>ä»ç¯å¢ƒå˜é‡è¯»å–ã€åŒºåˆ†å¤§å°å†™ã€‘<ul>
<li>AutomaticEnv()</li>
<li>BindEnv(input â€¦string)</li>
<li>errorSetEnvPrefix(in string)</li>
<li>SetEnvKeyReplacer(r *strings.Replacer)</li>
<li>AllowEmptyEnv(allowEmptyEnv bool)</li>
</ul>
</li>
</ol>
<hr>
<ol start="6">
<li>ä»å‘½ä»¤è¡Œæ ‡å¿—è¯»å–</li>
</ol>
<pre><code class="go">// ç»‘å®šå•ä¸ªæ ‡å¿—
viper.BindPFlag(&quot;token&quot;, pflag.Lookup(&quot;token&quot;))
</code></pre>
<hr>
<ol start="7">
<li>ä»è¿œç¨‹ Key&#x2F;Value å­˜å‚¨è¯»å–</li>
</ol>
<hr>
<h4 id="è¯»å–é…ç½®"><a href="#è¯»å–é…ç½®" class="headerlink" title="è¯»å–é…ç½®"></a>è¯»å–é…ç½®</h4><h3 id="åº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶-Cobra"><a href="#åº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶-Cobra" class="headerlink" title="åº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶ Cobra"></a>åº”ç”¨çš„å‘½ä»¤è¡Œæ¡†æ¶ Cobra</h3><ol>
<li>å‘½ä»¤éœ€è¦å…·å¤‡ Help åŠŸèƒ½ï¼Œè¿™æ ·æ‰èƒ½å‘Šè¯‰ä½¿ç”¨è€…å¦‚ä½•å»ä½¿ç”¨</li>
<li>å‘½ä»¤éœ€è¦èƒ½å¤Ÿè§£æå‘½ä»¤è¡Œå‚æ•°å’Œé…ç½®æ–‡ä»¶</li>
<li>å‘½ä»¤éœ€è¦èƒ½å¤Ÿåˆå§‹åŒ–ä¸šåŠ¡ä»£ç ï¼Œå¹¶æœ€ç»ˆå¯åŠ¨ä¸šåŠ¡è¿›ç¨‹</li>
</ol>
<h2 id="åº”ç”¨çš„ä¸‰å¤§åŸºæœ¬åŠŸèƒ½"><a href="#åº”ç”¨çš„ä¸‰å¤§åŸºæœ¬åŠŸèƒ½" class="headerlink" title="åº”ç”¨çš„ä¸‰å¤§åŸºæœ¬åŠŸèƒ½"></a>åº”ç”¨çš„ä¸‰å¤§åŸºæœ¬åŠŸèƒ½</h2><ul>
<li><p>API æœåŠ¡ï¼šé€šè¿‡å¯¹å¤–æä¾› HTTP&#x2F;RPC æ¥å£æ¥å®ŒæˆæŒ‡å®šçš„åŠŸèƒ½ã€‚æ¯”å¦‚è®¢å•æœåŠ¡ï¼Œé€šè¿‡è°ƒç”¨åˆ›å»ºè®¢å•çš„ API æ¥å£ï¼Œæ¥åˆ›å»ºå•†å“è®¢å•ã€‚</p>
</li>
<li><p>é API æœåŠ¡ï¼šé€šè¿‡ç›‘å¬ã€å®šæ—¶è¿è¡Œç­‰æ–¹å¼ï¼Œè€Œä¸æ˜¯é€šè¿‡ API è°ƒç”¨æ¥å®ŒæˆæŸäº›ä»»åŠ¡ã€‚æ¯”å¦‚æ•°æ®å¤„ç†æœåŠ¡ï¼Œå®šæ—¶ä» Redis ä¸­è·å–æ•°æ®ï¼Œå¤„ç†åå­˜å…¥åç«¯å­˜å‚¨ä¸­ã€‚å†æ¯”å¦‚æ¶ˆæ¯å¤„ç†æœåŠ¡ï¼Œç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ NSQ&#x2F;Kafka&#x2F;RabbitMQï¼‰ï¼Œæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="å¯åŠ¨æµç¨‹ä¸€è‡´"><a href="#å¯åŠ¨æµç¨‹ä¸€è‡´" class="headerlink" title="å¯åŠ¨æµç¨‹ä¸€è‡´"></a>å¯åŠ¨æµç¨‹ä¸€è‡´</h3><img src="/2022/11/22/15-go-viper-cobra-pflag/%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.webp" class="" title="å¯åŠ¨æµç¨‹">

<ol>
<li>åº”ç”¨æ¡†æ¶æ„å»º<br>a. å‘½ä»¤è¡Œç¨‹åº<br>b. å‘½ä»¤è¡Œå‚æ•°è§£æ<br>c. é…ç½®æ–‡ä»¶è§£æ</li>
<li>åº”ç”¨åˆå§‹åŒ–</li>
<li>æœåŠ¡å¯åŠ¨<br>a. åˆ›å»º API æœåŠ¡æˆ–é API æœåŠ¡<br>b. å¯åŠ¨æœåŠ¡</li>
</ol>
<blockquote>
<p>åº”ç”¨æ¡†æ¶æ„å»ºå’Œä¸šåŠ¡å…³ç³»ä¸å¤§ï¼Œå¯ä»¥æŠ½è±¡æˆç»Ÿä¸€çš„æ¡†æ¶ã€‚<br>åº”ç”¨åˆå§‹åŒ–å’ŒæœåŠ¡å¯åŠ¨ï¼Œä¸ä¸šåŠ¡è”ç³»è¾ƒå¯†åˆ‡ï¼Œéš¾ä»¥æŠ½è±¡ç§°ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶</p>
</blockquote>
<h2 id="iam-apiServer"><a href="#iam-apiServer" class="headerlink" title="iam-apiServer"></a>iam-apiServer</h2>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2022-11-22</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Moon</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/GoLang/'>
                            GoLang
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E5%90%8E%E7%AB%AF/'>
                            åç«¯
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        ä»¥ä¸Šã€‚ 
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://comment-hexo-waline.vercel.app/',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'æ­£ç¡®çš„é‚®ç®±åœ°å€ï¼Œå›å¤å°†èƒ½å¾—åˆ°é‚®ä»¶é€šçŸ¥ã€‚', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                    
                    
                    <div class="footer">
    
        <span> 
            Â©2021-2023 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
    
</div>


    
<link rel="stylesheet" href="/css/a11y-dark.min.css">

    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
                </div>
            
    </body>
</html>