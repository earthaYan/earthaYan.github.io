<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0,  viewport-fit=cover" name="viewport" />
    <meta name="description" content="go-æ•°æ®åº“" />
    <meta name="hexo-theme-A4" content="v1.7.1" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Diary</title>

    
        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
            
<link rel="stylesheet" href="/css/waline.css">

        
    
    
<link rel="stylesheet" href="/css/ui.css">
 
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>
    
    <body>
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    
<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Diary</a> 
            <span class="description">å¤‡å¿˜å½•/ç¬”è®°æœ¬</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        <div class="post-main-title">
            go-æ•°æ®åº“
        </div>
      
    

    <div class="post-md">
        
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#mysql"><span class="post-toc-text">mysql</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#sql-Open%E7%AC%AC%E4%BA%8C%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F"><span class="post-toc-text">sql.Openç¬¬äºŒå‚æ•°å½¢å¼</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="post-toc-text">å¸¸ç”¨æ–¹æ³•</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%BF%85%E9%A1%BB%E5%BC%95%E5%85%A5%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%8C%85"><span class="post-toc-text">å¿…é¡»å¼•å…¥çš„ä¸¤ä¸ªåŒ…</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SQLite"><span class="post-toc-text">SQLite</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%BF%85%E9%A1%BB%E5%AF%BC%E5%85%A5%E7%9A%84%E5%8C%85"><span class="post-toc-text">å¿…é¡»å¯¼å…¥çš„åŒ…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%92%8Cmysql%E5%8C%BA%E5%88%AB"><span class="post-toc-text">å’ŒmysqlåŒºåˆ«</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PostgreSQL"><span class="post-toc-text">PostgreSQL</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%BF%85%E9%A1%BB%E5%AF%BC%E5%85%A5%E7%9A%84%E5%8C%85-1"><span class="post-toc-text">å¿…é¡»å¯¼å…¥çš„åŒ…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%92%8Cmysql%E5%8C%BA%E5%88%AB-1"><span class="post-toc-text">å’ŒmysqlåŒºåˆ«</span></a></li></ol></li></ol>
        
        <h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><pre><code class="go">package main

import (
    &quot;database/sql&quot;
    &quot;fmt&quot;

    _ &quot;github.com/go-sql-driver/mysql&quot;
)

func checkErr(err error) &#123;
    if err != nil &#123;
        panic(err)
    &#125;
&#125;
func useMysql() &#123;
    // æ‰“å¼€ä¸€ä¸ªæ³¨å†Œè¿‡çš„æ•°æ®åº“é©±åŠ¨,ç¬¬äºŒä¸ªå‚æ•°ä¸ºdata source name
    db, err := sql.Open(&quot;mysql&quot;, &quot;root:123456@tcp(116.204.108.126:3306)/test?charset=utf8&quot;)
    checkErr(err)
    // æ’å…¥æ•°æ®
    // è¿”å›å‡†å¤‡è¦æ‰§è¡Œçš„sqlæ“ä½œï¼Œç„¶åè¿”å›å‡†å¤‡å®Œæ¯•çš„æ‰§è¡ŒçŠ¶æ€
    stmt, err := db.Prepare(&quot;INSERT INTO userinfo SET username=?,department=?,created=?&quot;)
    checkErr(err)
    // æ‰§è¡Œstmtå‡†å¤‡å¥½çš„SQLè¯­å¥
    // ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯=?å¯¹åº”çš„æ•°æ®
    res, err := stmt.Exec(&quot;amy&quot;, &quot;ç ”å‘éƒ¨é—¨&quot;, &quot;2012-12-09&quot;)
    checkErr(err)
    id, err := res.LastInsertId()
    checkErr(err)
    fmt.Println(id)
    // ä¿®æ”¹æ•°æ®
    stmt, err = db.Prepare(&quot;update userinfo set username=? where uid=?&quot;)
    checkErr(err)
    res, err = stmt.Exec(&quot;astaxieupdate&quot;, id)
    checkErr(err)
    affect, err := res.RowsAffected()
    checkErr(err)
    fmt.Println(affect)
    // æŸ¥è¯¢æ•°æ®
    // ç›´æ¥æ‰§è¡ŒSqlè¿”å›Rowsç»“æœ
    rows, err := db.Query(&quot;SELECT * FROM userinfo&quot;)
    checkErr(err)
    for rows.Next() &#123;
        var uid int
        var username string
        var department string
        var created string
        err = rows.Scan(&amp;uid, &amp;username, &amp;department, &amp;created)
        checkErr(err)
        fmt.Println(uid)
        fmt.Println(username)
        fmt.Println(department)
        fmt.Println(created) 
    &#125;
    // åˆ é™¤æ•°æ®
    stmt, err = db.Prepare(&quot;delete from userinfo where uid=?&quot;)
    checkErr(err)
    res, err = stmt.Exec(id)
    checkErr(err)
    affect, err = res.RowsAffected()
    checkErr(err)
    fmt.Println(affect)
    db.Close() //å…³é—­æ•°æ®åº“è¿æ¥
&#125;
</code></pre>
<h3 id="sql-Openç¬¬äºŒå‚æ•°å½¢å¼"><a href="#sql-Openç¬¬äºŒå‚æ•°å½¢å¼" class="headerlink" title="sql.Openç¬¬äºŒå‚æ•°å½¢å¼"></a>sql.Openç¬¬äºŒå‚æ•°å½¢å¼</h3><pre><code class="bash">user@unix(/path/to/socket)/dbname?charset=utf8
user:password@tcp(localhost:5555)/dbname?charset=utf8
user:password@/dbname
user:password@tcp([de:ad:be:ef::ca:fe]:80)/dbname
</code></pre>
<h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><ul>
<li>sql.Open()ï¼šæ‰“å¼€ä¸€ä¸ªæ³¨å†Œè¿‡çš„æ•°æ®åº“é©±åŠ¨</li>
<li>db.Prepare()ï¼šè¿”å›å‡†å¤‡è¦æ‰§è¡Œçš„sqlæ“ä½œï¼Œç„¶åè¿”å›å‡†å¤‡å®Œæ¯•çš„æ‰§è¡ŒçŠ¶æ€</li>
<li>db.Query()ï¼šç”¨æ¥ç›´æ¥æ‰§è¡ŒSqlè¿”å›Rowsç»“æœ</li>
<li>stmt.Exec()ï¼šç”¨æ¥æ‰§è¡Œstmtå‡†å¤‡å¥½çš„SQLè¯­å¥</li>
</ul>
<blockquote>
<p>ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯&#x3D;?å¯¹åº”çš„æ•°æ®ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢SQLæ³¨å…¥</p>
</blockquote>
<h4 id="å¿…é¡»å¼•å…¥çš„ä¸¤ä¸ªåŒ…"><a href="#å¿…é¡»å¼•å…¥çš„ä¸¤ä¸ªåŒ…" class="headerlink" title="å¿…é¡»å¼•å…¥çš„ä¸¤ä¸ªåŒ…"></a>å¿…é¡»å¼•å…¥çš„ä¸¤ä¸ªåŒ…</h4><ol>
<li><pre><code>&quot;database/sql&quot;
</code></pre>
</li>
<li>_ â€œgithub.com&#x2F;go-sql-driver&#x2F;mysqlâ€ &#x2F;&#x2F;é©±åŠ¨</li>
</ol>
<h2 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h2><h3 id="å¿…é¡»å¯¼å…¥çš„åŒ…"><a href="#å¿…é¡»å¯¼å…¥çš„åŒ…" class="headerlink" title="å¿…é¡»å¯¼å…¥çš„åŒ…"></a>å¿…é¡»å¯¼å…¥çš„åŒ…</h3><ul>
<li>â€œdatabase&#x2F;sqlâ€</li>
<li>_ â€œgithub.com&#x2F;mattn&#x2F;go-sqlite3â€ &#x2F;&#x2F;é©±åŠ¨</li>
</ul>
<h3 id="å’ŒmysqlåŒºåˆ«"><a href="#å’ŒmysqlåŒºåˆ«" class="headerlink" title="å’ŒmysqlåŒºåˆ«"></a>å’ŒmysqlåŒºåˆ«</h3><p>å¯¼å…¥é©±åŠ¨ï¼š<code>db, err := sql.Open(&quot;sqlite3&quot;, &quot;./foo.db&quot;)</code></p>
<h2 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><h3 id="å¿…é¡»å¯¼å…¥çš„åŒ…-1"><a href="#å¿…é¡»å¯¼å…¥çš„åŒ…-1" class="headerlink" title="å¿…é¡»å¯¼å…¥çš„åŒ…"></a>å¿…é¡»å¯¼å…¥çš„åŒ…</h3><ul>
<li>â€œdatabase&#x2F;sqlâ€</li>
<li>_ â€œgithub.com&#x2F;lib&#x2F;pqâ€ &#x2F;&#x2F;é©±åŠ¨</li>
</ul>
<h3 id="å’ŒmysqlåŒºåˆ«-1"><a href="#å’ŒmysqlåŒºåˆ«-1" class="headerlink" title="å’ŒmysqlåŒºåˆ«"></a>å’ŒmysqlåŒºåˆ«</h3><ol>
<li>PostgreSQLæ˜¯é€šè¿‡$1,$2è¿™ç§æ–¹å¼æ¥æŒ‡å®šè¦ä¼ é€’çš„å‚æ•°ï¼Œè€Œä¸æ˜¯MySQLä¸­çš„?</li>
<li>sql.Openä¸­çš„dsnä¿¡æ¯çš„æ ¼å¼ä¹Ÿä¸MySQLçš„é©±åŠ¨ä¸­çš„dsnæ ¼å¼ä¸ä¸€æ ·</li>
</ol>
<pre><code class="go">func usePostgreSQL() &#123;
    connStr := &quot;postgres://postgres:123456@116.204.108.126:3306/test?sslmode=disable&quot;
    db, err := sql.Open(&quot;postgres&quot;, connStr)
    checkErr(err)
    // æ’å…¥æ•°æ®
    stmt, err := db.Prepare(&quot;INSERT INTO userinfo(username,department,created) VALUES($1,$2,$3) RETURNING uid&quot;)
    checkErr(err)
    res, err := stmt.Exec(&quot;astaxie&quot;, &quot;ç ”å‘éƒ¨é—¨&quot;, &quot;2012-12-09&quot;)
    checkErr(err)
    var lastInsertId int
    err = db.QueryRow(&quot;INSERT INTO userinfo(username,department,created) VALUES($1,$2,$3) returning uid;&quot;, &quot;astaxie&quot;, &quot;ç ”å‘éƒ¨é—¨&quot;, &quot;2012-12-09&quot;).Scan(&amp;lastInsertId)
    checkErr(err)
    fmt.Println(&quot;æœ€åæ’å…¥id =&quot;, lastInsertId, res)
    // ä¿®æ”¹æ•°æ®
    stmt, err = db.Prepare(&quot;update userinfo set username=$1 where uid=$2&quot;)
    checkErr(err)
    res, err = stmt.Exec(&quot;astaxieupdate&quot;, lastInsertId)
    checkErr(err)
    affect, err := res.RowsAffected()
    checkErr(err)
    fmt.Println(affect)

    // æŸ¥çœ‹æ•°æ®
    rows, err := db.Query(&quot;SELECT * FROM userinfo&quot;)
    checkErr(err)
    for rows.Next() &#123;
        var uid int
        var username string
        var department string
        var created string
        err = rows.Scan(&amp;uid, &amp;username, &amp;department, &amp;created)
        checkErr(err)
        fmt.Println(uid)
        fmt.Println(username)
        fmt.Println(department)
        fmt.Println(created)
    &#125;
    // åˆ é™¤æ•°æ®
    stmt, err = db.Prepare(&quot;delete from userinfo where uid=$1&quot;)
    checkErr(err)
    res, err = stmt.Exec(lastInsertId)
    checkErr(err)
    affect, err = res.RowsAffected()
    checkErr(err)
    fmt.Println(affect)
    db.Close()
&#125;
</code></pre>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-01-12</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Moon</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/GoLang/'>
                            GoLang
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E5%90%8E%E7%AB%AF/'>
                            åç«¯
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    
        
    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        ä»¥ä¸Šã€‚ 
    </div>
    
        

    <div id="waline"></div>
    <script type="module"  >
        import { init } from 'https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs'; 
        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://comment-hexo-waline.vercel.app/',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
                search: false, // ç¦æ­¢è¡¨æƒ…åŒ…æœç´¢
                reaction: false, // å¯¹æ–‡ç« æ‰“åˆ†
                pageview: false, // æµè§ˆé‡ç»Ÿè®¡
                comment: false, // è¯„è®ºæ•°ç»Ÿè®¡

                locale: {
                    placeholder: 'æ­£ç¡®çš„é‚®ç®±åœ°å€ï¼Œå›å¤å°†èƒ½å¾—åˆ°é‚®ä»¶é€šçŸ¥ã€‚', 
                    sofa: ''
                },
            });
            
        }
        window.addEventListener('DOMContentLoaded', loadWaline);
    </script>



    
    
    
    </div>


     
</div>



                    
                    
                    <div class="footer">
    
        <span> 
            Â©2021-2023 China 

            
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
    
</div>


    
<link rel="stylesheet" href="/css/a11y-dark.min.css">

    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/highlightjs-line-numbers.js"></script>



<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>
                </div>
            
    </body>
</html>