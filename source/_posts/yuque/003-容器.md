---
title: 003-容器
urlname: pm52tk
date: '2021-12-27 22:44:34 +0800'
tags: [docker]
categories: [docker]
---

## docker Cli 命令行

1. 查看本地 docker 版本：`docker version`
1. 查看 docker 当前状态：`docker info`
1. docker 命令行用法：`docker 管理对象 操作命令`

![1640616763(1).png](https://cdn.nlark.com/yuque/0/2021/png/115484/1640616770537-8016d3e1-c675-4017-95b6-14c191d1f94c.png#clientId=uca0fa219-c973-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=231&id=uede722e1&margin=%5Bobject%20Object%5D&name=1640616763%281%29.png&originHeight=462&originWidth=720&originalType=binary∶=1&rotation=0&showTitle=true&size=27622&status=done&style=none&taskId=u80ad1c9c-ab8a-458e-8568-117962854e7&title=docker%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4&width=360 "docker管理命令")

---

## 容器与镜像

### 镜像 image：

- 是一个只读文件，可以理解为模板
- 这个文件包含文件系统，源码，库文件，依赖，工具等运行 application 需要的文件
- 具有分层的概念

### 容器 container:

- 运行中的 docker 镜像
- 本质是复制镜像，并在镜像最上层添加一层 read-write 的层（container layer 容器层）
- 基于一个 image 可以创建多个 container

![container-layers.png](https://cdn.nlark.com/yuque/0/2021/png/115484/1640617359024-1505c1b3-9c4a-4286-ad59-17442eaa87d5.png#clientId=ud15fb9a4-7674-4&crop=0&crop=0&crop=1&crop=1&from=drop&id=u72401d0e&margin=%5Bobject%20Object%5D&name=container-layers.png&originHeight=338&originWidth=511&originalType=binary∶=1&rotation=0&showTitle=true&size=5816&status=done&style=none&taskId=u0fb75abf-eb43-446b-b8c5-252e96140cf&title=container%20layer "container layer")

### docker 镜像获取：

- 自己制作
- 从 docker 仓库拉取

---

## docker 容器基本操作：

1. docker container run nginx(镜像) :用 nginx 镜像创建并运行一个容器
1. docker container stop container_name/id:停止容器运行
1. docker container ls:查看 docker 容器列表，-q 参数表示只显示容器 id
1. docker container rm container_id：删除容器，不能删除运行中的容器
1. container 可以省略，dokcer ps[简化命令]===docker container ls[完整命令]

---

## 技巧之批量操作：

- 批量停止容器
  - docker container stop $(docker container ps -aq)
  - docker container rm $(docker container ps -aq)

---

## 容器的 attached 和 detached 模式：

- attached 模式:
  - 前台运行模式
  - 容器的输入输出结果 attach 和本地的输入输出能够互相穿透影响
  - 会导致当前进程卡住，并输出日志至当前控制台。
  - 只有在前台模式下，才有必要设置-it 命令选项，为容器设置伪 TTY
  - 一般用在开发调试过程中短期运行
- detached 模式[推荐]:
  - 容器后台运行模式
  - 在后台运行，不会让当前进程卡住，可以做其他事情
  - 一般用在上线中
- 以*后台模式*创建并运行容器：`docker run -d image_id`
- 本地连接到正在运行中的容器：`docker attach container_id`

![1640620124(1).png](https://cdn.nlark.com/yuque/0/2021/png/115484/1640620131993-9e328937-73b3-4ec0-8996-7ee8db501e4e.png#clientId=ud15fb9a4-7674-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=65&id=u3a52c01f&margin=%5Bobject%20Object%5D&name=1640620124%281%29.png&originHeight=129&originWidth=928&originalType=binary∶=1&rotation=0&showTitle=false&size=14168&status=done&style=none&taskId=uddee751c-006a-4892-8c32-506d76c3dd6&title=&width=464)

### detached 模式下查看容器日志:

- `docker container logs container_id`
- -f 参数：动态跟踪 log

---

## 容器的交互式模式：

### docker container run -it ubuntu sh:

- 交互式创建容器
- -it 参数交互模式
- 当退出容器的时候，容器会停止

### docker exec -it container_id sh:

- 进入正在运行的容器内部
- 退出容器的时候，容器不会停止

---

## 容器和虚拟机

![vm.png](https://cdn.nlark.com/yuque/0/2021/png/115484/1640621706516-922041c8-b4c2-423d-8ccd-6e2c975eb56e.png#clientId=u2cada16a-4afc-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u587d257b&margin=%5Bobject%20Object%5D&name=vm.png&originHeight=388&originWidth=700&originalType=binary∶=1&rotation=0&showTitle=true&size=151940&status=done&style=none&taskId=u925fe8ab-e989-464a-995a-9fb096fc315&title=%E5%AE%B9%E5%99%A8%E5%92%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8C%BA%E5%88%AB "容器和虚拟机区别")

1. 容器不是 Mini 虚拟机
1. 容器本质是进程
1. 容器中的进程被限制了对 CPU 内存等资源的访问
1. 进程停止，容器退出

查看容器里运行的进程：docker container top container_id
![1640622177(1).png](https://cdn.nlark.com/yuque/0/2021/png/115484/1640622182852-20735dc9-c55a-412e-9645-66d1bf124d7b.png#clientId=u2cada16a-4afc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=115&id=uc1ca4448&margin=%5Bobject%20Object%5D&name=1640622177%281%29.png&originHeight=230&originWidth=1884&originalType=binary∶=1&rotation=0&showTitle=false&size=24452&status=done&style=none&taskId=ue5e6e4dc-205c-4de1-a778-d3c8c63483d&title=&width=942)
![1640622277(1).png](https://cdn.nlark.com/yuque/0/2021/png/115484/1640622292837-1c27ed37-00d0-415f-80e3-ecffaa2a174d.png#clientId=u2cada16a-4afc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=68&id=u76e2a125&margin=%5Bobject%20Object%5D&name=1640622277%281%29.png&originHeight=136&originWidth=1592&originalType=binary∶=1&rotation=0&showTitle=false&size=13477&status=done&style=none&taskId=ue93ca565-b36b-41b7-a39d-fea9b3c7c3b&title=&width=796)

---

## 创建容器内部流程：

以 docker container run -d --port 80:80 --name webhost nginx

1. 在本地查找是否有 nginx 镜像，未发现
1. 去远程的 docker 仓库查找 nginx 镜像
1. 下载最新版的 nginx 镜像
1. 基于 nginx 镜像创建一个新的容器，并准备运行
1. docker engine 分配给这个容器一个虚拟 ip 地址
1. 在宿主机上打开 80 端口并把容器端口转发到宿主机上
1. 启动容器，运行指定的命令（这里是一个 shell 脚本去启动 nginx）
