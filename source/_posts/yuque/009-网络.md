---
title: 009-网络
urlname: uqidam
date: '2022-01-24 21:43:31 +0800'
tags: [docker]
categories: [docker]
---

### 常用网络命令：

- ip addr ：显示网络信息
- ifconfig：查看当前机器 ip 地址
- ping ：测试目标地址可达性
- telnet：测试端口可达性
- tracepath：进行路径跟踪
- curl 请求 web 服务

### 容器网络通信 bridge：

docker network ls:查看机器
docker network inspect network_id
![](https://cdn.nlark.com/yuque/0/2022/png/115484/1643051173260-dfa2b83d-7c85-4228-a918-5cd8e6b8a63a.png#clientId=u56268d83-d688-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ubd88663e&margin=%5Bobject%20Object%5D&originHeight=662&originWidth=1060&originalType=url∶=1&rotation=0&showTitle=false&status=done&style=none&taskId=u9beac318-af1f-4c10-aa84-5b92d5ad8e1&title=)
容器之间进行通信原理：bridge 网络就类似于路由器，容器就类似于电脑

```bash
[
    {
        "Name": "bridge",
        "Id": "100bbdc32a45cfbf003b1a9360bf555567b45fe0977558fb2c69ee30afd6ae77",
        "Created": "2022-01-21T06:35:15.658690954Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.17.0.0/16",
                    "Gateway": "172.17.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {
            "27324a28c819bd5c498eaf6385cdd19e22d703d5273f461aec99b8ced7045652": {
                "Name": "web1",
                "EndpointID": "b0c807d7a768f12281291614d6ad7892a10904bb11fcdd196654b04118a9ca77",
                "MacAddress": "02:42:ac:11:00:05",
                "IPv4Address": "172.17.0.5/16",
                "IPv6Address": ""
            },
            "b10de8248c56c8eb7990585e14a570696adea8d9a9c3fbde6e304d41514814df": {
                "Name": "oracle-logminer",
                "EndpointID": "d930a3212f5333d0807621bba48c5da0de90c4f850d6d8966255b63fc1d396f9",
                "MacAddress": "02:42:ac:11:00:02",
                "IPv4Address": "172.17.0.2/16",
                "IPv6Address": ""
            },
            "b8c97f62b9ec1336bb2472638183bd3a8d55e5a51482833752bbe4af99855f3c": {
                "Name": "box1",
                "EndpointID": "4d809d3c62dacb17e8c7f6cac4bd60d25dda304949c9f84fd44486b6c50f7065",
                "MacAddress": "02:42:ac:11:00:03",
                "IPv4Address": "172.17.0.3/16",
                "IPv6Address": ""
            },
            "f2a563ce05fb59a8d7a838101e44d70ea6aa0621e598b46ddc3e574498ee7fc4": {
                "Name": "web2",
                "EndpointID": "4b6abf1110c8e51e85fd2a92d7ed3a6c213a765de1cbf273311eb2b21eddcb99",
                "MacAddress": "02:42:ac:11:00:06",
                "IPv4Address": "172.17.0.6/16",
                "IPv6Address": ""
            },
            "fa0415f8855456b65ca10294404a034fa6c40ef0d193a31e60e9fb21d8d2f20e": {
                "Name": "box2",
                "EndpointID": "3d048720378b9a742bcd761dd38e7528cfa22bf1fd5b6cc85b90eac192f23ecf",
                "MacAddress": "02:42:ac:11:00:04",
                "IPv4Address": "172.17.0.4/16",
                "IPv6Address": ""
            }
        },
        "Options": {
            "com.docker.network.bridge.default_bridge": "true",
            "com.docker.network.bridge.enable_icc": "true",
            "com.docker.network.bridge.enable_ip_masquerade": "true",
            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",
            "com.docker.network.bridge.name": "docker0",
            "com.docker.network.driver.mtu": "1500"
        },
        "Labels": {}
    }
]
```

容器对外进行通信原理：
会使用 NAT 网络地址先进行地址转换

```bash
[root@localhost ~]# ip route
default via 10.186.64.1 dev eth0 //会转换为10.186.64.1
10.186.64.0/24 dev eth0 proto kernel scope link src 10.186.64.6
169.254.0.0/16 dev eth0 scope link metric 1002
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1
172.18.0.0/16 dev br-cd69bad471d5 proto kernel scope link src 172.18.0.1
```

创建 bridge: `**docker network create -d myBridge**`

```bash
[root@localhost ~]# docker network ls
NETWORK ID     NAME       DRIVER    SCOPE
100bbdc32a45   bridge     bridge    local
cd69bad471d5   dtle-net   bridge    local
3e96331f9162   host       host      local
de7827084d56   myBridge   bridge    local
8edca5cac061   none       null      local
[root@localhost ~]# docker network inspect de7
[
    {
        "Name": "myBridge",
        "Id": "de7827084d56d2758bd8087253cfceba3142d21b092593968b947ffc35bc3fbc",
        "Created": "2022-01-24T19:25:03.882729025Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.19.0.0/16",
                    "Gateway": "172.19.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {},
        "Options": {},
        "Labels": {}
    }
]
[root@localhost ~]# docker network inspect cd6
[
    {
        "Name": "dtle-net",
        "Id": "cd69bad471d5d14f3f422063083606eeefe9c38c0c19d5e681f6d51637ecff85",
        "Created": "2022-01-21T06:56:35.70635156Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": {},
            "Config": [
                {
                    "Subnet": "172.18.0.0/16",
                    "Gateway": "172.18.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {
            "0ac2131e0a56d5a7018fe27f2466483f061710f43679c4400580aaadcf7ee7ad": {
                "Name": "mysql-dst",
                "EndpointID": "d1861878921f626068ac89805d7c7ee552ea4daf571b6638a3a77251609a68be",
                "MacAddress": "02:42:ac:12:00:03",
                "IPv4Address": "172.18.0.3/16",
                "IPv6Address": ""
            },
            "6be81fa2704b6acd2256c8d9af9b52440e5e973e0a29b04464cd2e09e4b2d3b4": {
                "Name": "mysql-src",
                "EndpointID": "3c39722ca20f5517c2d83d52179b67f5695b6b4b75fd8c3a3badc86de5c45f36",
                "MacAddress": "02:42:ac:12:00:02",
                "IPv4Address": "172.18.0.2/16",
                "IPv6Address": ""
            }
        },
        "Options": {},
        "Labels": {}
    }
]
```

创建容器的时候指定 bridge
容器建立以后，使用 docker network connect bridge_name container_name

### 端口转发：

docker run -p 80:8080p
与 dockerfile 关系：EXPOSE 只是声明类型

### 命名空间：

暂无

---

练习：

- 准备镜像
- 准备网络
- 创建容器并连接到网络

```bash
# prepare image
docker image pull redis
docker image build -t flask-demo .

# create network
docker network create -d bridge demo-network

# create container
docker container run -d --name redis-server --network demo-network redis
docker container run -d --network demo-network --name flask-demo --env REDIS_HOST=redis-server -p 5000:5000 flask-demo
```
