---
title: 01-安装
urlname: grduwu
date: '2022-06-28 23:06:14 +0800'
tags: [electron]
categories: [electron]
---

```bash
PS D:\privateFiles\my-electron-app> yarn add electron --save-dev
yarn add v1.22.10
info No lockfile found.
[1/4] Resolving packages...
[2/4] Fetching packages...
[3/4] Linking dependencies...
[4/4] Building fresh packages...
error D:\privateFiles\my-electron-app\node_modules\electron: Command failed.
Exit code: 1
Command: node install.js
Arguments:
Directory: D:\privateFiles\my-electron-app\node_modules\electron
Output:
RequestError: getaddrinfo ENOTFOUND objects.githubusercontent.com
    at ClientRequest.<anonymous> (D:\privateFiles\my-electron-app\node_modules\got\source\request-as-event-emitter.js:178:14)
    at Object.onceWrapper (node:events:510:26)
    at ClientRequest.emit (node:events:402:35)
    at ClientRequest.origin.emit (D:\privateFiles\my-electron-app\node_modules\@szmarczak\http-timer\source\index.js:37:11)
    at TLSSocket.socketErrorListener (node:_http_client:447:9)
    at TLSSocket.emit (node:events:390:28)
    at emitErrorNT (node:internal/streams/destroy:157:8)
    at emitErrorCloseNT (node:internal/streams/destroy:122:3)
    at processTicksAndRejections (node:internal/process/task_queues:83:21)
info Visit https://yarnpkg.com/en/docs/cli/add for documentation about this command.
```

解决方法：设置 electron 代理解决

```bash
npm config set electron_mirror https://npm.taobao.org/mirrors/electron/
```

---

流程：

1. 启动 node.js 应用，把 Electron 作为依赖加入
1. 创建 main.js 脚本运行控制应用程序的主进程，这个主进程运行在 Node.js 环境中。使用 Electron 的 app 和 BrowserWindow 模块创建一个浏览器窗口，在一个单独的渲染器进程里展示 web 内容
1. 为了在渲染器中使用一些 Node.js 功能，将一个 preload 脚本附加到 BrowserWindow 构造函数中。

---

打包发布应用： [Electron Forge](https://www.electronforge.io/)

```bash
PS D:\privateFiles\my-electron-app> npx electron-forge import
✔ Checking your system
✔ Initializing Git Repository
✔ Writing modified package.json file
✖ Installing dependencies

An unhandled error has occurred inside Forge:
Failed to install modules: ["electron-squirrel-startup"]

With output: Command failed with a non-zero return code (1):
yarn add electron-squirrel-startup
yarn add v1.22.10
[1/4] Resolving packages...
[2/4] Fetching packages...
[3/4] Linking dependencies...
info If you think this is a bug, please open a bug report with the information provided in "D:\\privateFiles\\my-electron-app\\yarn-error.log".
info Visit https://yarnpkg.com/en/docs/cli/add for documentation about this command.

error An unexpected error occurred: "EBUSY: resource busy or locked, unlink 'D:\\privateFiles\\my-electron-app\\node_modules\\electron\\dist\\icudtl.dat'".
error An unexpected error occurred: "EBUSY: resource busy or locked, unlink 'D:\\privateFiles\\my-electron-app\\node_modules\\electron\\dist\\icudtl.dat'".

Error: Failed to install modules: ["electron-squirrel-startup"]

With output: Command failed with a non-zero return code (1):
yarn add electron-squirrel-startup
yarn add v1.22.10
[1/4] Resolving packages...
[2/4] Fetching packages...
[3/4] Linking dependencies...
info If you think this is a bug, please open a bug report with the information provided in "D:\\privateFiles\\my-electron-app\\yarn-error.log".
info Visit https://yarnpkg.com/en/docs/cli/add for documentation about this command.

error An unexpected error occurred: "EBUSY: resource busy or locked, unlink 'D:\\privateFiles\\my-electron-app\\node_modules\\electron\\dist\\icudtl.dat'".
error An unexpected error occurred: "EBUSY: resource busy or locked, unlink 'D:\\privateFiles\\my-electron-app\\node_modules\\electron\\dist\\icudtl.dat'".

    at Object._default [as default] (D:\privateFiles\my-electron-app\node_modules\@electron-forge\core\dist\util\install-dependencies.js:55:19)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at async D:\privateFiles\my-electron-app\node_modules\@electron-forge\core\dist\api\import.js:149:9
```

解决步骤：
安装依赖：yarn add electron-squirrel-startup

```bash
PS D:\privateFiles\my-electron-app> yarn add electron-squirrel-startup
yarn add v1.22.10
[1/4] Resolving packages...
[2/4] Fetching packages...
[3/4] Linking dependencies...
error An unexpected error occurred: "EBUSY: resource busy or locked, unlink 'D:\\privateFiles\\my-electron-app\\node_modules\\electron\\dist\\v8_context_snapshot.bin'".
info If you think this is a bug, please open a bug report with the information provided in "D:\\privateFiles\\my-electron-app\\yarn-error.log".
info Visit https://yarnpkg.com/en/docs/cli/add for documentation about this command.
```

删除 node_modules 文件夹，使用 yarn install 重新安装依赖

```bash
PS D:\privateFiles\my-electron-app> yarn start
yarn run v1.22.10
$ electron-forge start
✔ Checking your system
✔ Locating Application

An unhandled rejection has occurred inside Forge:
Error: Could not find any Electron packages in devDependencies

Electron Forge was terminated. Location:
{}
error Command failed with exit code 1.
```

使用 yarn add electron --dev 安装缺少的依赖

```bash
PS D:\privateFiles\my-electron-app> yarn run make
yarn run v1.22.10
$ electron-forge make
✔ Checking your system
✔ Resolving Forge Config
We need to package your application before we can make it
✔ Preparing to Package Application for arch: x64
✔ Preparing native dependencies
✔ Packaging Application

An unhandled rejection has occurred inside Forge:
Error: Could not find any make targets configured for the "win32" platform.

Electron Forge was terminated. Location:
{}
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
```

执行 npx electron-forge import 命令自动添加配置项
继续执行 yarn run make 生成可执行文件

> electron-forge package 只是打包成一个目录到 out 目录下，注意这种打包一般用于调试，并不是用于分发
> electron-forge make 这个才会打出真正的分发包，放在 out/make 目录下

---
