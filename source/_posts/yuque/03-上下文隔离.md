---
title: 03-上下文隔离
urlname: ple31d
date: '2022-07-04 22:14:36 +0800'
tags: [electron]
categories: [electron]
---

## 概念：

上下文隔离（Context Isolation）这一特性可以确保你在 webContents 中加载的网站中，`preload`脚本和 Electron 内部的逻辑运行在不同的上下文环境中
之前->preload.js 与渲染器共享 window 对象
之后->contextBridge 模块隔绝上下文，不共享 window 对象，

## 必要性：

安全性：阻止网站访问 Electron 内部组件或者 preload 脚本有权访问的 Api
表现：

- preload 脚本中有权访问的 window 对象与网站可以访问的 window 对象完全是不同对象

解决方法：使用 contextBridge 模块

```typescript
export interface IElectronAPI {
  hello: string;
}
declare global {
  interface Window {
    electronAPI: IElectronAPI;
  }
}
export {};
```

```typescript
import { contextBridge } from "electron";
contextBridge.exposeInMainWorld("electronAPI", {
  hello: "你好",
});
```

```typescript
// renderer.ts
console.log(window.electronAPI.hello);
```

![4cdc092b-c69d-4993-9926-d72548ba8089.jpeg](https://cdn.nlark.com/yuque/0/2022/jpeg/115484/1656996528144-188f2e41-7e28-457a-802e-973cc617642f.jpeg#clientId=u681448a6-4027-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=389&id=u9c22d60c&margin=%5Bobject%20Object%5D&name=4cdc092b-c69d-4993-9926-d72548ba8089.jpeg&originHeight=681&originWidth=632&originalType=binary∶=1&rotation=0&showTitle=false&size=61810&status=done&style=none&taskId=u847e3d72-cb0f-4e8d-ae4a-619d1182c8a&title=&width=361.14285714285717)
共享变量的时候最好封装一层

```typescript
// ❌ Bad code
contextBridge.exposeInMainWorld("myAPI", {
  send: ipcRenderer.send,
});
```

```typescript
// ✅ Good code
contextBridge.exposeInMainWorld("myAPI", {
  loadPreferences: () => ipcRenderer.invoke("load-prefs"),
});
```
